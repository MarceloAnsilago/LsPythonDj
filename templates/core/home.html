{% extends "_base.html" %}

{% block title %}Inicio - LongShortDjango{% endblock %}

{% block content %}

<div class="py-3">

  <div class="mb-3">

    <h1 class="h5 fw-semibold mb-1">Operacoes em andamento</h1>

    <p class="text-body-secondary small mb-0">

      Acompanhe as metricas de cada operacao aberta. Clique em um card para revisar ou encerrar.

    </p>

  </div>

  <div id="home-operations-root" data-url="{{ operations_data_url }}">

    <div class="card soft-card shadow-sm rounded-4 mb-3">

      <div class="card-body text-center py-5">

        <div class="spinner-border" role="status" aria-hidden="true"></div>

        <div class="small text-body-secondary mt-3">Carregando operacoes em andamento...</div>

      </div>

    </div>

  </div>

</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const container = document.getElementById("home-operations-root");
  if (!container) {
    return;
  }
  const url = container.dataset.url;
  if (!url) {
    container.innerHTML = '<div class="alert alert-danger small mb-0">URL de dados nao configurada.</div>';
    return;
  }
  fetch(url, {
    headers: {
      "X-Requested-With": "XMLHttpRequest",
    },
  })
    .then((response) => {
      if (!response.ok) {
        throw new Error("Falha ao carregar as operacoes.");
      }
      return response.json();
    })
    .then((payload) => {
      if (payload && payload.html) {
        container.innerHTML = payload.html;
      } else {
        throw new Error("Resposta invalida.");
      }
    })
    .catch(() => {
      container.innerHTML =
        '<div class="alert alert-warning small mb-0">Nao foi possivel carregar as operacoes agora. Tente novamente em alguns segundos.</div>';
    });
});
</script>
{% endblock %}
