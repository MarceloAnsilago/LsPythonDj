{% extends "_base.html" %}
{% load static %}

{% block title %}Pares — LongShortDjango{% endblock %}

{% block extra_head %}
  <script src="https://unpkg.com/htmx.org@1.9.12"></script>
{% endblock %}

{% block content %}
<div class="py-3">

  <!-- Título + ações (Caçar / Recalcular) -->
  <div class="d-flex align-items-center justify-content-between mb-2">
    <h1 class="h4 mb-0">Pares</h1>

    <div class="d-flex gap-2 align-items-center">
      <!-- Caçar -->
      <form
        hx-post="{% url 'pairs:hunt_start' %}"
        hx-target="#huntStatus"
        hx-swap="outerHTML"
        hx-indicator="#huntSpinner"
        class="d-inline">
        {% csrf_token %}
        <button class="btn btn-outline-warning btn-sm">
          <i class="bi bi-fast-forward"></i> Caçar ({{ BASE_WINDOW }}→…)
        </button>
      </form>
      <div id="huntSpinner" class="htmx-indicator spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>

      <!-- Recalcular base (AGORA COM STATUS) -->
      <form
        hx-post="{% url 'pairs:refresh_start' %}"
        hx-target="#refreshStatus"
        hx-swap="outerHTML"
        class="d-inline">
        {% csrf_token %}
        <button class="btn btn-outline-primary btn-sm">
          <i class="bi bi-arrow-repeat"></i> Recalcular (base {{ BASE_WINDOW }}d)
        </button>
      </form>
    </div>
  </div>
  <!-- status da caça -->
  <div id="huntStatus" class="mb-2"></div>
  <!-- status do recálculo -->
  <div id="refreshStatus" class="mb-3"></div>

  <div class="row g-3">
    <!-- Grid A -->
    <div class="col-12 col-xl-6">
      <div class="card shadow-sm rounded-4 soft-card">
        <div class="card-header d-flex align-items-center justify-content-between card-header-compact">
          <span class="fw-semibold">Grid A — Pares (janela-base {{ BASE_WINDOW }}d)</span>
          <span class="text-body-secondary small">Soft UI + Dark Mode</span>
        </div>
        <div class="card-body p-0">
          {% include "pairs/_pairs_table.html" with pairs=pairs %}
        </div>
      </div>
    </div>

    <!-- Grid B -->
    <div class="col-12 col-xl-6">
      <div class="card shadow-sm rounded-4 soft-card">
        <div class="card-header d-flex align-items-center justify-content-between card-header-compact">
          <span class="fw-semibold">Grid B — Scanner por janelas</span>
          <div id="scanSpinner" class="htmx-indicator spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>
        </div>
        <div class="card-body p-0" id="scanPane">
          <div class="p-3 text-body-secondary">
            Selecione um par no Grid A (<i class="bi bi-search"></i> Scan) para ver o scanner
            [{{ SCAN_MIN }}…{{ SCAN_MAX }}].
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Z-score -->
  <div class="card shadow-sm rounded-4 soft-card mt-3">
    <div class="card-header d-flex align-items-center justify-content-between card-header-compact">
      <span class="fw-semibold">Z-score</span>
      <div id="zChartSpinner" class="htmx-indicator spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>
    </div>
    <div class="card-body" id="zChartPane">
      <div class="text-body-secondary">Escolha um período no Scanner para carregar o gráfico.</div>
    </div>
  </div>

</div>
{% endblock %}
