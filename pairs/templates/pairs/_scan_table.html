<div class="table-responsive card-scroll rows-7">
  <table class="table table-hover table-sm align-middle mb-0 table-compact table-sticky">
    <colgroup>
      <col class="col-par">
      <col class="col-janela">
      <col class="col-z">
      <col class="col-adf">
      <col class="col-beta">
      <col class="col-z">
      <col class="col-half">
      <col class="col-status">
      <col class="col-status">
      <col class="col-actions">
    </colgroup>

    <thead class="table-light">
      <tr class="text-secondary small">
        <th>Par</th>
        <th class="text-center">Período</th>
        <th class="text-center">Dickey-F.</th>
        <th class="text-center">ADF%</th>
        <th class="text-center">β</th>
        <th class="text-center">Z</th>
        <th class="text-center">Half-life</th>
        <th class="text-center">Corr30/60</th>
        <th class="text-center">Status</th>
        <th class="text-end col-actions">Ação</th>
      </tr>
    </thead>

    <tbody class="table-group-divider">
      {% for r in rows %}
        <tr class="{% if best and r.window == best.window %}table-primary{% endif %}">
          <td>{{ pair }}</td>
          <td class="text-center"><span class="badge text-bg-secondary badge-pill">{{ r.window }}d</span></td>
          <td class="text-center">{% if r.adf_pvalue is not None %}{{ r.adf_pvalue|floatformat:4 }}{% else %}—{% endif %}</td>
          <td class="text-center">{% if r.adf_pct is not None %}{{ r.adf_pct|floatformat:1 }}%{% else %}—{% endif %}</td>
          <td class="text-center">{% if r.beta is not None %}{{ r.beta|floatformat:4 }}{% else %}—{% endif %}</td>
          <td class="text-center">{% if r.zscore is not None %}{{ r.zscore|floatformat:2 }}{% else %}—{% endif %}</td>
          <td class="text-center">{% if r.half_life is not None %}{{ r.half_life|floatformat:1 }}{% else %}—{% endif %}</td>
          <td class="text-center">
            {% if r.corr30 is not None and r.corr60 is not None %}
              {{ r.corr30|floatformat:2 }} / {{ r.corr60|floatformat:2 }}
            {% else %}—{% endif %}
          </td>
          <td class="text-center">
            {% if r.status == "ok" %}
              <span class="badge text-bg-success badge-pill" title="{{ r.message }}">ok</span>
            {% elif r.status == "pendente" %}
              <span class="badge text-bg-secondary badge-pill" title="{{ r.message }}">pendente</span>
            {% elif r.status == "reprovado" %}
              <span class="badge text-bg-warning badge-pill" title="{{ r.message }}">reprovado</span>
            {% else %}
              <span class="badge text-bg-danger badge-pill" title="{{ r.message }}">erro</span>
            {% endif %}
          </td>

          <!-- Ação: agora texto "Análise" com o MESMO ícone (check) e HTMX para o gráfico -->
          <td class="text-end">
            <a class="btn btn-success btn-sm"
               href="{% url 'pairs:zscore' pair.id r.window %}"
               hx-get="{% url 'pairs:zscore' pair.id r.window %}"
               hx-target="#zChartPane"
               hx-indicator="#zChartSpinner"
               hx-swap="innerHTML"
               title="Abrir análise (gráfico Z-score) para {{ r.window }}d">
              <i class="bi bi-check2-circle"></i> Análise
            </a>
          </td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="10" class="text-center py-4 text-body-secondary">Scanner sem resultados.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
